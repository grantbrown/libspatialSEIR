
<!DOCTYPE html>
<html lang="en">
  <head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>2014 Ebola Epidemic</title>
    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/ebola.css" rel="stylesheet">
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://grantbrown.github.io/libspatialSEIR/">libspatialSEIR</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="#toc-section-anchor">TOC</a></li>
            <li><a href="http://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology">Compartmental Models</a></li>
            <li><a href="http://en.wikipedia.org/wiki/2014_Guinea_Ebola_outbreak">More on the Outbreak</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
  
  
    <div id = "title-section" class = "container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Estimating and Predicting Epidemic Behavior for the 2014 West African Ebola Outbreak</h1>
          <h4>A Quick and Dirty Spatial SEIR Modeling Approach</h4>
          <h5>Grant Brown</h5>
          <h5>Last Updated: 7/22/2014</h5>
        </div>
      </div>
    </div>
    <a id="toc-section-anchor" class="anchor"></a>
    <div id="toc-section" class="container">
      <h2>Table of Contents</h2>
      <div class = "row">
        <div class="col-sm-11 col-sm-offset-1">
          <ol>
            <li><a href="#introduction-sect">Introduction</a>
              <ul>
                <li><a href="#intro-outbreak-sect">The Outbreak</li>
                <li><a href="#intro-data-sect">The Data</li>
                <li><a href="#intro-compartment-sect">Compartmental Models</li>
              </ul>
            </li>
            <li><a href="#analysis-1-sect">Analysis 1: Polynomial Basis</a>
              <ul>
                <li><a href="#analysis-1-set-up-sect">Set Up</a></li>
                <li><a href="#analysis-1-convergence-sect">Convergence Diagnosis</a></li>
                <li><a href="#analysis-1-estimates-sect">Estimated Epidemic Behavior</a></li>
                <li><a href="#analysis-1-r0-sect">Basic Reproductive Number</a></li>
                <li><a href="#analysis-1-prediction-sect">Prediction</a></li>
              </ul>
            </li>
            <li><a href="#anchor-analysis-2-sect">Analysis 2: Natural Spline Basis</a></li>
          </ol>
        </div>
      </div>
    </div>

    <div class="container">
      <a id="introduction-sect" class="anchor"></a>
      <h2>Introduction</h2>
      <div class="row">
        <div class = "col-sm-10 col-sm-offset-1">
        <a id="intro-outbreak-sect" class="anchor"></a>
        <h3>The Outbreak</h3>
          <p>
          The 2014 Ebola outbreak in West Africa is an ongoing public health crisis, which has killed hundreds of people so far. The cross-border nature of this epidemic, which has emerged in Gunea, Liberia and Sierra Leone has complicated mitigation efforts, as has the poor health infrastructure in the region. While there has been much analysis and speculation about the factors at play in the spread of the virus, there aren't many specific predicitons about the expected duration and severity of this particular epidemic. In the (certainly temporary) absence of peer reivewed epidemic forecasts, this document explores a simple spatial SEIR model to make some initial forecasts. 
          </p>
          <a id="intro-data-sect" class="anchor"></a>
        <h3>The Data</h3>
        <p>
        A summary of the WHO case reports is very helpfully compiled on wikipedia for analysts who are too lazy to read the case reports themselves. Let's read it in with the xml library: 
      </p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
<div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(coda)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: lattice
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(spatialSEIR)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: Rcpp
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(XML)</span>
<span class="hl std">url</span> <span class="hl kwb">=</span> <span class="hl str">'http://en.wikipedia.org/wiki/2014_West_Africa_Ebola_outbreak'</span>
<span class="hl std">tbls</span> <span class="hl kwb">=</span> <span class="hl kwd">readHTMLTable</span><span class="hl std">(url)</span>
<span class="hl std">dat</span> <span class="hl kwb">=</span> <span class="hl std">tbls[[</span><span class="hl num">2</span><span class="hl std">]]</span>

<span class="hl std">rptDate</span> <span class="hl kwb">=</span> <span class="hl kwd">as.Date</span><span class="hl std">(dat[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(dat),</span><span class="hl num">1</span><span class="hl std">],</span> <span class="hl str">&quot;%d %b %Y&quot;</span><span class="hl std">)</span>
<span class="hl std">original.rptDate</span> <span class="hl kwb">=</span> <span class="hl std">rptDate</span>
<span class="hl std">ascendingOrder</span> <span class="hl kwb">=</span> <span class="hl kwd">order</span><span class="hl std">(rptDate)</span>
<span class="hl std">rptDate</span> <span class="hl kwb">=</span> <span class="hl std">rptDate[ascendingOrder][</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(rptDate)]</span>
<span class="hl std">original.rptDate</span> <span class="hl kwb">=</span> <span class="hl std">original.rptDate[ascendingOrder]</span>
<span class="hl std">Guinea</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">V4[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(dat)]))[ascendingOrder]</span>
<span class="hl std">Guinea</span> <span class="hl kwb">=</span> <span class="hl kwd">ifelse</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(Guinea),</span> <span class="hl num">0</span><span class="hl std">, Guinea)</span>
<span class="hl std">Liberia</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">V6[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(dat)]))[ascendingOrder]</span>
<span class="hl std">Liberia</span> <span class="hl kwb">=</span> <span class="hl kwd">ifelse</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(Liberia),</span> <span class="hl num">0</span><span class="hl std">, Liberia)</span>
<span class="hl std">Sierra.Leone</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">V8[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(dat)]))[ascendingOrder]</span>
<span class="hl std">Sierra.Leone</span> <span class="hl kwb">=</span> <span class="hl kwd">ifelse</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(Sierra.Leone),</span> <span class="hl num">0</span><span class="hl std">,Sierra.Leone)</span>

<span class="hl com"># Define the plot for the next section</span>
<span class="hl std">ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea, Sierra.Leone, Liberia)),</span>
             <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea, Sierra.Leone, Liberia)))</span>
<span class="hl std">figure1</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
      <span class="hl kwd">plot</span><span class="hl std">(original.rptDate, Guinea,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Raw Data: Case Counts From Wikipedia&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Total Cases&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">ylim</span> <span class="hl std">= ylim,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
      <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1000</span><span class="hl std">,</span> <span class="hl num">50</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
      <span class="hl kwd">lines</span><span class="hl std">(original.rptDate, Liberia,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
      <span class="hl kwd">lines</span><span class="hl std">(original.rptDate, Sierra.Leone,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
      <span class="hl kwd">legend</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= original.rptDate[</span><span class="hl num">1</span><span class="hl std">],</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl kwd">max</span><span class="hl std">(ylim),</span> <span class="hl kwc">legend</span> <span class="hl std">=</span>
               <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">),</span>
             <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span><span class="hl str">&quot;red&quot;</span><span class="hl std">),</span> <span class="hl kwc">bg</span><span class="hl std">=</span><span class="hl str">&quot;white&quot;</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">1.1</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>
<p>
With data in hand, let's begin where every analysis should begin: graphs.
</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rimage center"><img src="figure/unnamed-chunk-2.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" class="plot" /></div></div>
<p>
These represent cumulative counts, but because case reports can be revised downward due to non-Ebola illnesses the graphs are not monotone. If someone would hire an intern to read all the case reports and compile their best guess as to actual case infection times, that would be pretty awesome. Instead, let's just "un-cumulate"* the data and bound it at zero to get a rough estimate of new case counts over time. 
<br/>

<small> *Unlike uncumulate, decumulate is actually a word. Unfortunately it just means "to decrease", and so was unsuitable for use here. There should probably be a word for uncumulating things, perhaps uncumulate. </small></p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
<div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">uncumulate</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">out</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(x[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(x)]</span><span class="hl opt">-</span><span class="hl std">x[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(x)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)])</span>
    <span class="hl kwd">ifelse</span><span class="hl std">(out</span> <span class="hl opt">&gt;=</span> <span class="hl num">0</span><span class="hl std">, out,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl com"># The &quot;I_star&quot; name will make more sense in a bit</span>
<span class="hl std">I_star</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl kwd">uncumulate</span><span class="hl std">(Guinea),</span>
               <span class="hl kwd">uncumulate</span><span class="hl std">(Liberia),</span>
               <span class="hl kwd">uncumulate</span><span class="hl std">(Sierra.Leone))</span>


<span class="hl com"># Define figure 2 for next section</span>
<span class="hl std">ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl kwd">max</span><span class="hl std">(I_star))</span>
<span class="hl std">figure2</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
    <span class="hl kwd">layout</span><span class="hl std">(</span><span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">),</span>
        <span class="hl kwc">widths</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">8</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">),</span> <span class="hl kwc">heights</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">4</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">))</span>
    <span class="hl kwd">plot</span><span class="hl std">(rptDate, I_star[,</span><span class="hl num">1</span><span class="hl std">],</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Crude Guess at New Case Counts Over Time&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;New Cases&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">2</span>
         <span class="hl std">)</span>
    <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">max</span><span class="hl std">(ylim),</span> <span class="hl num">10</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">points</span><span class="hl std">(rptDate, I_star[,</span><span class="hl num">2</span><span class="hl std">],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">points</span><span class="hl std">(rptDate, I_star[,</span><span class="hl num">3</span><span class="hl std">],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xaxt</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">yaxt</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">bty</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xpd</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
    <span class="hl kwd">plot</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;n&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span>  <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span><span class="hl kwc">xlab</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">legend</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">legend</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Gunea&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">),</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span>
           <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">))</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xpd</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xaxt</span><span class="hl std">=</span><span class="hl str">&quot;s&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">yaxt</span><span class="hl std">=</span><span class="hl str">&quot;s&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">bty</span><span class="hl std">=</span><span class="hl str">&quot;o&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<p>
  Here's a look at the "un-cumulated" counts. The process is a bit noisier from this perspective. 
</p>

<div class="chunk" id="unnamed-chunk-4"><div class="rimage center"><img src="figure/unnamed-chunk-4.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div></div>

      <a id="intro-compartment-sect" class="anchor"></a>
      <h3>Compartmental Models</h3>
      <p>
        Now that we've got data read in and made a couple of plots to ensure we haven't done anything to terribly stupid with it
        , let's do some compartmental epidemic modeling. Not only has Ebola been <a href="http://www.ncbi.nlm.nih.gov/pubmed/17156292">well modeled in the past</a> using compartmental modeling techniques, but this author happens to be working on a software library designed to fit compartmental models in the spatial SEIRS family. What a strange coincidence! Specifically, we'll be using heirarchical Bayesian estimation methods to fit a spatial SEIR model to the data.  
        <br/>
        
        While a full treatment of this field of epidemic modeling is (far) beyond the scope of this writing, the basic idea is pretty intuitive. In order to come up with a simplified model of a disease process, discrete disease states (aka, compartments) are defined. The most common of these are S, E, I, and R which stand for:<br>
      </p>
      <ul>
        <li><strong>S</strong>usceptible to a particular disease</li>
        <li><strong>E</strong>xposed and infected, but not yet infectious</li>
        <li><strong>I</strong>nfectious and capable of transmitting the disease</li>
        <li><strong>R</strong>emoved or recovered</li>
      </ul>
  <p>
    This sequence traversed by members of a population (S to E to I to R) forms what we might call the temporal process model of our analysis. This analysis belongs to the stochastic branch of the compartmental modeling family, which has its roots in deterministic systems of ordinary and partial differential equations. In this framework, transitions between the compartments occur according to unknown probabilities. It is the S to E probability, which captures infection activity, into which we introduce spatial structure. Some details of this are given as comments to the code below, and more information than you probably want on the statistical particulars is available in <a href="https://github.com/grantbrown/libspatialSEIR/blob/master/doc/models/SEIR_Algo.pdf">this pdf document</a>. For now, suffice it to say that we'll place a simple spatial structure on the epidemic process which simply allows disease to spread between the three nations involved, and we'll try to estimate the strength of that relationship. Many other potential structures are possible, limited primarily by the ammount of additional research and data compilation you are willing to do. <br/>
We're not going to do anything fancy with demographic information or public health intervention dates. Demographic parameters are relatively difficult to estimate here, as there are only three spatial units which are all from the same region. Intervention dates are more promising, but their inclusion requires much more background research than we have time for here. In the interest of simplicity and estimability, we'll just fit a different disease intensity parameter for each of the three countries in addition to as a set of basis functions to capture the temporal trend. 
  </p>
    </div>
    <div class="col-sm-1">
    </div>
  </div>
  <a id="analysis-1-sect" class = "anchor"></a>
  <h2>Analysis 1</h2> 
  <div class="row">
    <div class = "col-sm-10 col-sm-offset-1">
      <a id="analysis-1-set-up-sect" class = "anchor">
      <h3>Set Up</h3></a>
  <p>
    There are some things we need to define before we can start fitting models and making predictions. 
  </p>
  <ol>
    <li>The time points are not evenly spaced, so we need to define appropriate offset values to capture the ammount
    of aggregation performed (time between reports).</li>
    <li>We must define the spatial correlation structure.</li>
    <li>A set of basis functions needs to be chosen to capture the temporal trend.</li>
    <li>Prior parameters and parameter staring values must be specified for each <a href="http://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">chain.</a></li>
    <li>A whole bunch of bookkeeping stuff for which I haven't yet programmed sensible default behavior needs to be set up.</li>
  </ol>
  <p>
  More details are available in comments to the code below. 
  </p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Define the temporal offset vector to be the number of days reflected in each </span>
<span class="hl com"># aggregated record (time between reports).</span>
<span class="hl std">offsets</span> <span class="hl kwb">=</span> <span class="hl kwd">uncumulate</span><span class="hl std">(original.rptDate)</span>

<span class="hl com"># Define the simple &quot;distance&quot; matrix. There are 3 countries, all of which </span>
<span class="hl com"># share borders. Therefore we simply define a 3x3 matrix with zero diagonals </span>
<span class="hl com"># and 0.5 for the off diagonal values. 0.5 is used instead of 1 because</span>
<span class="hl com"># this normalized choice makes the matrix row stochastic, which makes the gods </span>
<span class="hl com"># of proper posterior distributions happy. </span>
<span class="hl std">DM</span> <span class="hl kwb">=</span> <span class="hl num">0.5</span><span class="hl opt">*</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">))</span>

<span class="hl com"># Define population sizes for the three countries of interest. This data also </span>
<span class="hl com"># from Wikipedia. </span>

<span class="hl com"># Guinea, Liberia, Sierra Leone</span>
<span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10057975</span><span class="hl std">,</span> <span class="hl num">4128572</span><span class="hl std">,</span> <span class="hl num">6190280</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(I_star),</span><span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span>
           <span class="hl kwc">byrow</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>

<span class="hl com"># Currently, the fixed and time varying co-variates driving the exposure </span>
<span class="hl com"># process must be specified separately This saves computer memory, but </span>
<span class="hl com"># makes things a bit more complicated. I might change this at some point. </span>

<span class="hl com"># For the fixed covariates, just fit a separate intercept for each location. </span>
<span class="hl std">X</span> <span class="hl kwb">=</span> <span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">)</span>

<span class="hl com"># For the time varying covariates, we first need to define a temporal index</span>
<span class="hl std">daysSinceJan</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(rptDate</span> <span class="hl opt">-</span> <span class="hl kwd">as.Date</span><span class="hl std">(</span><span class="hl str">&quot;2014-01-01&quot;</span><span class="hl std">))</span>

<span class="hl com"># For this analysis, let's use orthogonal polynomials of degree 3 for the </span>
<span class="hl com"># temporal basis. Analysis 2 will compare the prediction performance of the </span>
<span class="hl com"># polynomial based model to a spline basis. </span>
<span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl kwd">poly</span><span class="hl std">(daysSinceJan,</span> <span class="hl kwc">degree</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">)</span>

<span class="hl com"># We're going to want to do prediction, so let's generate the fixed and time </span>
<span class="hl com"># varying prediction covariate matrices now as well</span>
<span class="hl std">X.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">))</span>
<span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">predict.poly</span><span class="hl std">(Z,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
                              <span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span> <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl std">,</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">)))</span>

<span class="hl com"># The time varying covariates are the same for each spatial location for this</span>
<span class="hl com"># analysis, so we just duplicate them row-wise</span>
<span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl std">Z[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),]</span>
<span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">Z.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z.predict),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),]</span>

<span class="hl com"># Let's combine X and Z into their more usual form for later use in prediction.</span>
<span class="hl std">X.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(X.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(X.predict),</span>
                             <span class="hl kwc">each</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(Z.predict)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)),], Z.predict)</span>

<span class="hl com"># Define prediction offsets. </span>
<span class="hl std">offset.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">6</span><span class="hl std">))</span>

<span class="hl com"># There's no reinfection process for Ebola, but we still need to provide dummy</span>
<span class="hl com"># values for the reinfection terms. This will be changed (along with most of </span>
<span class="hl com"># the R level API) Dummy covariate matrix:</span>
<span class="hl std">X_p_rs</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl com"># Dummy covariate matrix dimension. Why, exactly, am I not just grabbing this </span>
<span class="hl com"># kind of thing from Rcpp? No good reason at all: this will be fixed. </span>
<span class="hl std">xPrsDim</span> <span class="hl kwb">=</span> <span class="hl kwd">dim</span><span class="hl std">(X_p_rs)</span>
<span class="hl com"># Dummy value for reinfection params</span>
<span class="hl std">beta_p_rs</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(X_p_rs))</span>
<span class="hl com"># Dummy value for reinfection params prior precision</span>
<span class="hl std">betaPrsPriorPrecision</span> <span class="hl kwb">=</span> <span class="hl num">0.5</span>

<span class="hl com"># Get object dimensions. Again, this will be done automatically in the future</span>
<span class="hl std">compMatDim</span> <span class="hl kwb">=</span> <span class="hl kwd">dim</span><span class="hl std">(I_star)</span>
<span class="hl std">xDim</span> <span class="hl kwb">=</span> <span class="hl kwd">dim</span><span class="hl std">(X)</span>
<span class="hl std">zDim</span> <span class="hl kwb">=</span> <span class="hl kwd">dim</span><span class="hl std">(Z)</span>

<span class="hl com"># Declare prior parameters for the E to I and I to R probabilities. </span>
<span class="hl std">priorAlpha_gammaEI</span> <span class="hl kwb">=</span> <span class="hl num">250</span><span class="hl std">;</span>
<span class="hl std">priorBeta_gammaEI</span> <span class="hl kwb">=</span> <span class="hl num">1000</span><span class="hl std">;</span>
<span class="hl std">priorAlpha_gammaIR</span> <span class="hl kwb">=</span> <span class="hl num">140</span><span class="hl std">;</span>
<span class="hl std">priorBeta_gammaIR</span> <span class="hl kwb">=</span> <span class="hl num">1000</span><span class="hl std">;</span>

<span class="hl com"># Declare prior precision for exposure model paramters</span>
<span class="hl std">betaPriorPrecision</span> <span class="hl kwb">=</span> <span class="hl num">0.1</span>

<span class="hl com"># Set the reinfection mode to 3, which indicates that S_star, or the newly </span>
<span class="hl com"># susceptibles, must remain zero. People are very unlikely to get ebola twice.</span>
<span class="hl com"># How were you to know that &quot;3&quot; denotes a traditional SEIR model as opposed to</span>
<span class="hl com"># a serial SEIR or SEIRS model? No good reason at all, actually. The planned R </span>
<span class="hl com"># API will make the distinction between SEIRmodel SEIRSmodel and </span>
<span class="hl com"># SerialSEIRmodel objects, so in the future you won't have to worry about this</span>
<span class="hl com"># unless you're digging into the c++ code. </span>
<span class="hl std">reinfectionMode</span> <span class="hl kwb">=</span> <span class="hl num">3</span>

<span class="hl com"># steadyStateConstraintPrecision is a loose constraint on net flows</span>
<span class="hl com"># between compartments. Setting it to a negative value eliminates</span>
<span class="hl com"># the constraint, but it can help with identifiability in cases where </span>
<span class="hl com"># there should be a long term equilibrium (endemic disease, for example).</span>
<span class="hl com"># We do not need this parameter here. </span>
<span class="hl std">steadyStateConstraintPrecision</span> <span class="hl kwb">=</span> <span class="hl opt">-</span><span class="hl num">1</span>

<span class="hl com"># iterationStride determines the delay between saving samples to the specified</span>
<span class="hl com"># output file As you can probably tell based on the high number chosen, </span>
<span class="hl com"># autocorrelation is currently a big problem for this library</span>
<span class="hl std">iterationStride</span> <span class="hl kwb">=</span> <span class="hl num">1000</span>

<span class="hl com"># We don't need no verbose or debug level output</span>
<span class="hl std">verbose</span> <span class="hl kwb">=</span> <span class="hl num">FALSE</span>
<span class="hl std">debug</span> <span class="hl kwb">=</span> <span class="hl num">FALSE</span>

<span class="hl com"># Declare initial tuning parameters for MCMC sampling</span>
<span class="hl std">mcmcTuningParams</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl com"># S_star</span>
                     <span class="hl num">1</span><span class="hl std">,</span> <span class="hl com"># E_star</span>
                     <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># R_star</span>
                     <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># S_0</span>
                     <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># I_0</span>
                     <span class="hl num">0.05</span><span class="hl std">,</span>  <span class="hl com"># beta</span>
                     <span class="hl num">0.0</span><span class="hl std">,</span>  <span class="hl com"># beta_p_rs, fixed in this case</span>
                     <span class="hl num">0.01</span><span class="hl std">,</span> <span class="hl com"># rho</span>
                     <span class="hl num">0.01</span><span class="hl std">,</span> <span class="hl com"># gamma_ei</span>
                     <span class="hl num">0.01</span><span class="hl std">)</span> <span class="hl com"># gamma_ir</span>


<span class="hl com"># We don't want to re-scale the distance matrix. </span>
<span class="hl std">scaleDistanceMode</span> <span class="hl kwb">=</span> <span class="hl num">0</span>

<span class="hl com"># Declare a function which can come up with several different starting values </span>
<span class="hl com"># for the model parameters. This will allow us to assess convergence. </span>
<span class="hl std">proposeParameters</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">seedVal</span><span class="hl std">,</span> <span class="hl kwc">chainNumber</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl kwd">set.seed</span><span class="hl std">(seedVal)</span>

    <span class="hl com"># 2 to 21 day incubation period according to who</span>
    <span class="hl std">p_ei</span> <span class="hl kwb">=</span> <span class="hl num">0.25</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0.02</span><span class="hl std">)</span>
    <span class="hl com"># Up to 7 weeks even after recovery</span>
    <span class="hl std">p_ir</span> <span class="hl kwb">=</span> <span class="hl num">0.14</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0.01</span><span class="hl std">)</span>
    <span class="hl std">gamma_ei</span><span class="hl kwb">=</span><span class="hl opt">-</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">p_ei)</span>
    <span class="hl std">gamma_ir</span><span class="hl kwb">=</span><span class="hl opt">-</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">p_ir)</span>

    <span class="hl com"># Starting value for exposure regression parameters</span>
    <span class="hl std">beta</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(X)</span> <span class="hl opt">+</span> <span class="hl kwd">ncol</span><span class="hl std">(Z))</span>
    <span class="hl std">beta[</span><span class="hl num">1</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl num">2.5</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">)</span>

    <span class="hl std">rho</span> <span class="hl kwb">=</span> <span class="hl num">0.1</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.01</span><span class="hl std">)</span> <span class="hl com"># spatial dependence parameter</span>

    <span class="hl std">outFileName</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;./chain_output_ebola_&quot;</span><span class="hl std">, chainNumber ,</span><span class="hl str">&quot;.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>

    <span class="hl com"># Make a crude guess as to the true compartments:</span>
    <span class="hl com"># S_star, E_star, R_star, and thus S,E,I and R</span>
    <span class="hl std">proposal</span> <span class="hl kwb">=</span> <span class="hl kwd">generateCompartmentProposal</span><span class="hl std">(I_star, N,</span>
                                           <span class="hl kwc">S0</span> <span class="hl std">= N[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">-</span><span class="hl std">I_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">86</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span>
                                           <span class="hl kwc">I0</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">86</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span>
                                           <span class="hl kwc">p_ir</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span>
                                           <span class="hl kwc">p_rs</span> <span class="hl std">=</span> <span class="hl num">0.00</span><span class="hl std">)</span>

    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">S0</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">S0,</span>
                <span class="hl kwc">E0</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">E0,</span>
                <span class="hl kwc">I0</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">I0,</span>
                <span class="hl kwc">R0</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">R0,</span>
                <span class="hl kwc">S_star</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">S_star,</span>
                <span class="hl kwc">E_star</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">E_star,</span>
                <span class="hl kwc">I_star</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">I_star,</span>
                <span class="hl kwc">R_star</span><span class="hl std">=proposal</span><span class="hl opt">$</span><span class="hl std">R_star,</span>
                <span class="hl kwc">rho</span><span class="hl std">=rho,</span>
                <span class="hl kwc">beta</span><span class="hl std">=beta,</span>
                <span class="hl kwc">gamma_ei</span><span class="hl std">=gamma_ei,</span>
                <span class="hl kwc">gamma_ir</span><span class="hl std">=gamma_ir,</span>
                <span class="hl kwc">outFileName</span><span class="hl std">=outFileName))</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
      </div>

<p>
  With the set up out of the way, we can finally build the models. In order to assess convergence, we'll make three model objects - one for each MCMC run. 
</p>
      
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">()</span>
<span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl std">;</span>
<span class="hl kwa">for</span> <span class="hl std">(seedVal</span> <span class="hl kwa">in</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">12345</span><span class="hl std">,</span><span class="hl num">543219</span><span class="hl std">,</span><span class="hl num">992134</span><span class="hl std">))</span>
<span class="hl std">{</span>
  <span class="hl kwd">set.seed</span><span class="hl std">(seedVal)</span>
  <span class="hl std">proposal</span> <span class="hl kwb">=</span> <span class="hl kwd">proposeParameters</span><span class="hl std">(seedVal, i)</span>
  <span class="hl std">SEIRmodels[[i]]</span> <span class="hl kwb">=</span> <span class="hl kwd">spatialSEIRModel</span><span class="hl std">(compMatDim,</span>
                      <span class="hl std">xDim,</span>
                      <span class="hl std">zDim,</span>
                      <span class="hl std">xPrsDim,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">S0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">E0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">I0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">R0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">S_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">E_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">I_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">R_star,</span>
                      <span class="hl std">offsets,</span>
                      <span class="hl std">X,</span>
                      <span class="hl std">Z,</span>
                      <span class="hl std">X_p_rs,</span>
                      <span class="hl std">DM,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">rho,</span>
                      <span class="hl std">priorAlpha_gammaEI,</span>
                      <span class="hl std">priorBeta_gammaEI,</span>
                      <span class="hl std">priorAlpha_gammaIR,</span>
                      <span class="hl std">priorBeta_gammaIR,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">beta,</span>
                      <span class="hl std">betaPriorPrecision,</span>
                      <span class="hl std">beta_p_rs,</span>
                      <span class="hl std">betaPrsPriorPrecision,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">gamma_ei,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">gamma_ir,</span>
                      <span class="hl std">N,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">outFileName,</span>
                      <span class="hl std">iterationStride,</span>
                      <span class="hl std">steadyStateConstraintPrecision,</span>
                      <span class="hl std">verbose,</span>
                      <span class="hl std">debug,</span>
                      <span class="hl std">mcmcTuningParams,</span>
                      <span class="hl std">reinfectionMode,</span>
                      <span class="hl std">scaleDistanceMode)</span>
  <span class="hl std">SEIRmodels[[i]]</span><span class="hl opt">$</span><span class="hl kwd">setRandomSeed</span><span class="hl std">(seedVal)</span>
  <span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl std">i</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">;</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Track the epidemc values in the output file for each location/time point. </span>
<span class="hl com"># This will allow estmation and prediction, but in large data sets can result in</span>
<span class="hl com"># a LOT of data being saved to disk. </span>
<span class="hl std">SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl com">#Guinea </span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">)</span> <span class="hl com">#Liberia</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">)</span> <span class="hl com">#Sierra Leone</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Make a helper function to run each chain, as well as update the metropolis </span>
<span class="hl com"># tuning parameters. </span>
<span class="hl std">runSimulation</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">modelObject</span><span class="hl std">,</span>
                         <span class="hl kwc">numBatches</span><span class="hl std">=</span><span class="hl num">500</span><span class="hl std">,</span>
                         <span class="hl kwc">batchSize</span><span class="hl std">=</span><span class="hl num">20</span><span class="hl std">,</span>
                         <span class="hl kwc">targetAcceptanceRatio</span><span class="hl std">=</span><span class="hl num">0.2</span><span class="hl std">,</span>
                         <span class="hl kwc">tolerance</span><span class="hl std">=</span><span class="hl num">0.05</span><span class="hl std">,</span>
                         <span class="hl kwc">proportionChange</span> <span class="hl std">=</span> <span class="hl num">0.1</span>
                        <span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl kwa">for</span> <span class="hl std">(batch</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">numBatches)</span>
    <span class="hl std">{</span>
        <span class="hl std">modelObject</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(batchSize)</span>
        <span class="hl std">modelObject</span><span class="hl opt">$</span><span class="hl kwd">updateSamplingParameters</span><span class="hl std">(targetAcceptanceRatio,</span>
                                             <span class="hl std">tolerance,</span>
                                             <span class="hl std">proportionChange)</span>
    <span class="hl std">}</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
      </div> 

<p>
  With the model objects created, let's do some short runs for each chain to try to choose sensible Metropolis tuning parameters. The following script uses the runSimulation function defined in the previous code block to do just that. 
</p>
      
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(SEIRmodels))</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Burning in tuning params for chain &quot;</span><span class="hl std">, i,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
    <span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodels[[i]])</span>
    <span class="hl std">SEIRmodels[[i]]</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>
    <span class="hl std">SEIRmodels[[i]]</span><span class="hl opt">$</span><span class="hl kwd">printAcceptanceRates</span><span class="hl std">()</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Burning in tuning params for chain 1
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.228
## I0:       0.198
## E_star:   0.082
## R_star:   0.139
## beta:     0.165, 0.165, 0.165, 0.165, 0.165, 0.165, 
## rho:      0.221
## gamma_ei:     0.191
## gamma_ir:     0.284
## Burning in tuning params for chain 2
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.245
## I0:       0.224
## E_star:   0.253
## R_star:   0.252
## beta:     0.308, 0.308, 0.308, 0.308, 0.308, 0.308, 
## rho:      0.288
## gamma_ei:     0.209
## gamma_ir:     0.259
## Burning in tuning params for chain 3
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.207
## I0:       0.268
## E_star:   0.17
## R_star:   0.167
## beta:     0.242, 0.242, 0.242, 0.242, 0.242, 0.242, 
## rho:      0.228
## gamma_ei:     0.245
## gamma_ir:     0.264
</pre></div>
</div></div>
</div>
      
<p>Now we can run the three chains for longer in order to acheive convergence. 
As before, we'll adjust the tuning parameters along the way. Astute readers may notice the frankly inconvenient number of samples requested
, and will correctly infer that autocorrelation is currently a major problem for this library. This problem is being worked on.</p>  
      
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(SEIRmodels))</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Running chain &quot;</span><span class="hl std">, i,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
    <span class="hl std">tm</span> <span class="hl kwb">=</span> <span class="hl kwd">system.time</span><span class="hl std">(</span><span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodels[[i]],</span>
                  <span class="hl kwc">numBatches</span><span class="hl std">=</span><span class="hl num">200</span><span class="hl std">,</span>
                  <span class="hl kwc">batchSize</span><span class="hl std">=</span><span class="hl num">10000</span><span class="hl std">,</span>
                  <span class="hl kwc">targetAcceptanceRatio</span><span class="hl std">=</span><span class="hl num">0.2</span><span class="hl std">,</span>
                  <span class="hl kwc">tolerance</span><span class="hl std">=</span><span class="hl num">0.025</span><span class="hl std">,</span>
                  <span class="hl kwc">proportionChange</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">))</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Time elapsed: &quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(tm[</span><span class="hl num">3</span><span class="hl std">]</span><span class="hl opt">/</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">3</span><span class="hl std">),</span>
              <span class="hl str">&quot; minutes\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Running chain 1
## Time elapsed: 11.278 minutes
## Running chain 2
## Time elapsed: 11.523 minutes
## Running chain 3
## Time elapsed: 11.272 minutes
</pre></div>
</div></div>
</div>

<a id="analysis-1-convergence-sect" class="anchor"></a>
<h3>Convergence Diagnosis</h3>

<p>As this is a Bayesian analysis in which the posterior distribution is sampled using MCMC techniques, we really need some
indication that the samplers have indeed converged to the posterior distribution in order to make any inferences about the 
problem at hand. In the code below, we'll read in the MCMC output files created so far, plot the three chains for each of 
several important parameters, and take a look at the Gelman and Rubin convergence diagnostic (which should be close to 1 if the chains have converged.)
</p>

<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Read in the output files created above</span>
<span class="hl std">chain1</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_1.txt&quot;</span><span class="hl std">)</span>
<span class="hl std">chain2</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_2.txt&quot;</span><span class="hl std">)</span>
<span class="hl std">chain3</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_3.txt&quot;</span><span class="hl std">)</span>

<span class="hl std">plotChains</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">c1</span><span class="hl std">,</span> <span class="hl kwc">c2</span><span class="hl std">,</span> <span class="hl kwc">c3</span><span class="hl std">,</span> <span class="hl kwc">main</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">idx</span> <span class="hl kwb">=</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(c1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(c1)</span>
    <span class="hl std">mcl</span> <span class="hl kwb">=</span> <span class="hl kwd">mcmc.list</span><span class="hl std">(</span><span class="hl kwd">as.mcmc</span><span class="hl std">(c1),</span>
                    <span class="hl kwd">as.mcmc</span><span class="hl std">(c2),</span>
                    <span class="hl kwd">as.mcmc</span><span class="hl std">(c3))</span>
    <span class="hl std">g.d</span> <span class="hl kwb">=</span> <span class="hl kwd">gelman.diag</span><span class="hl std">(mcl)</span>
    <span class="hl std">main</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(main,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Gelman Convergence Diagnostic and UL: \n&quot;</span><span class="hl std">,</span>
                 <span class="hl kwd">round</span><span class="hl std">(g.d[[</span><span class="hl num">1</span><span class="hl std">]][</span><span class="hl num">1</span><span class="hl std">],</span><span class="hl num">2</span><span class="hl std">),</span> <span class="hl str">&quot;, &quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(g.d[[</span><span class="hl num">1</span><span class="hl std">]][</span><span class="hl num">2</span><span class="hl std">],</span><span class="hl num">2</span><span class="hl std">))</span>

    <span class="hl kwd">plot</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">Iteration[idx], c1[idx],</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">= main,</span>
         <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Iteration&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(chain2</span><span class="hl opt">$</span><span class="hl std">Iteration[idx],c2[idx],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(chain3</span><span class="hl opt">$</span><span class="hl std">Iteration[idx],c3[idx],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;green&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl com"># Guinea, Liberia, Sierra Leone</span>
<span class="hl std">figure3</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl str">&quot;Guinea Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Linear Time Component&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl str">&quot;Liberia Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Quadratic Time Component&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl str">&quot;Sierra Leone Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Cubic Time Component&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl std">figure4</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;E to I Transition Probability&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;I to R Transition Probability&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-10"><div class="rimage center"><img src="figure/unnamed-chunk-10.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-11"><div class="rimage center"><img src="figure/unnamed-chunk-11.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" class="plot" /></div></div>

<a id="analysis-1-estimates-sect" class="anchor"></a>
<h3>Estimated Epidemic Behavior</h3>
<p>
  The convergence looks reasonable, so let's dissect the estimates a bit. 
</p>


<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">c1</span> <span class="hl kwb">=</span> <span class="hl std">chain1[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain1),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">,</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl num">10</span><span class="hl std">)]</span>
<span class="hl std">c2</span> <span class="hl kwb">=</span> <span class="hl std">chain2[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain2)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain2),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">,</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl num">10</span><span class="hl std">)]</span>
<span class="hl std">c3</span> <span class="hl kwb">=</span> <span class="hl std">chain3[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain3)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain3),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">,</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl num">10</span><span class="hl std">)]</span>

<span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl kwd">colnames</span><span class="hl std">(c1)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea Intercept&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia Intercept&quot;</span><span class="hl std">,</span>
                 <span class="hl str">&quot;Sierra Leone Intercept&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Linear Time Component&quot;</span><span class="hl std">,</span>
                 <span class="hl str">&quot;Quadratic Time Component&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Cubic Time Component&quot;</span><span class="hl std">,</span>
                 <span class="hl str">&quot;Spatial Dependence Parameter&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;E to I probability&quot;</span><span class="hl std">,</span>
                 <span class="hl str">&quot;I to R probability&quot;</span><span class="hl std">)</span>
<span class="hl kwd">colnames</span><span class="hl std">(c2)</span> <span class="hl kwb">=</span> <span class="hl kwd">colnames</span><span class="hl std">(c1)</span>
<span class="hl kwd">colnames</span><span class="hl std">(c3)</span> <span class="hl kwb">=</span> <span class="hl kwd">colnames</span><span class="hl std">(c1)</span>

<span class="hl std">mcl</span> <span class="hl kwb">=</span> <span class="hl kwd">mcmc.list</span><span class="hl std">(</span><span class="hl kwd">as.mcmc</span><span class="hl std">(c1),</span>
                <span class="hl kwd">as.mcmc</span><span class="hl std">(c2),</span>
                <span class="hl kwd">as.mcmc</span><span class="hl std">(c3))</span>
<span class="hl com"># summary(mcl) given below</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="output"><pre class="knitr r">## Output from coda library summary:
## ########################
</pre></div>
<div class="output"><pre class="knitr r">## 
## Iterations = 1:1007
## Thinning interval = 1 
## Number of chains = 3 
## Sample size per chain = 1007 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                                Mean      SD Naive SE Time-series SE
## Guinea Intercept             -4.560 0.24577 0.004471       0.010948
## Liberia Intercept            -2.649 0.21626 0.003935       0.008239
## Sierra Leone Intercept       -3.291 0.21931 0.003990       0.008992
## Linear Time Component         7.364 1.21508 0.022107       0.052472
## Quadratic Time Component     -8.474 0.82822 0.015068       0.036330
## Cubic Time Component          2.700 0.53675 0.009766       0.030400
## Spatial Dependence Parameter  0.216 0.03330 0.000606       0.001096
## E to I probability            0.121 0.00796 0.000145       0.000418
## I to R probability            0.112 0.00950 0.000173       0.000576
## 
## 2. Quantiles for each variable:
## 
##                                 2.5%    25%    50%    75%  97.5%
## Guinea Intercept              -5.046 -4.721 -4.559 -4.399 -4.075
## Liberia Intercept             -3.077 -2.791 -2.649 -2.511 -2.225
## Sierra Leone Intercept        -3.725 -3.435 -3.287 -3.141 -2.876
## Linear Time Component          5.018  6.534  7.331  8.168  9.788
## Quadratic Time Component     -10.121 -9.016 -8.460 -7.896 -6.902
## Cubic Time Component           1.666  2.341  2.699  3.058  3.769
## Spatial Dependence Parameter   0.158  0.193  0.214  0.237  0.290
## E to I probability             0.106  0.116  0.121  0.127  0.137
## I to R probability             0.095  0.106  0.112  0.118  0.133
</pre></div>
</div></div>

<p>The average time spent in a particular disease compartment is just one divided by the probability of 
a transition between compartments. The units here are days, so we can see that the average infectious time is estimated to be
(roughly) between 7 and 11 days, while the average latent time is (roughly) between 7 and 10 days. In reality, there is a lot 
of variability in these times for Ebola, but these seem like reasonable estimates for the average values. <br/>

We also notice that there is reasonably strong spatial dependence (the distribution of the spatial dependence parameter is well separated from zero), indicating reasonably strong mixing between the three populations. This is unsurprising, as the disease has in fact spread between all three nations. 
<br/>

It also appears that Guinea has the lowest estimated epidemic intensity, followed by Sierra Leone and Liberia, which have similar credible
intervals for their intercept parameters.
</p>


<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">getMeanAndCI</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">loc</span><span class="hl std">,</span><span class="hl kwc">tpt</span><span class="hl std">,</span><span class="hl kwc">baseStr</span><span class="hl std">=</span><span class="hl str">&quot;I_&quot;</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">chain1[[</span><span class="hl kwd">paste</span><span class="hl std">(baseStr, loc,</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">, tpt,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]]</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">vec[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(vec)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(vec)]</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">mean</span><span class="hl std">(vec),</span> <span class="hl kwd">quantile</span><span class="hl std">(vec,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">,</span> <span class="hl num">0.95</span><span class="hl std">))))</span>
<span class="hl std">}</span>

<span class="hl std">Guinea.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">Liberia.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">SierraLeone.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl std">maxI</span> <span class="hl kwb">=</span> <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea.I.Est, Liberia.I.Est, SierraLeone.I.Est))</span>
<span class="hl std">figure5</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Guinea Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Liberia Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">plot</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Sierra Leone Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-15"><div class="rimage center"><img src="figure/unnamed-chunk-15.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" class="plot" /></div></div>

<a id="analysis-1-r0-sect" class="anchor"></a>
<h3>Basic Reproductive Number Calculation</h3>
<p>
A common tool for describing the development and containment of an epidemic is a quantity known as the basic reproductive numer, or the basic reproductive ratio, or one of several other variants on that theme. The basic idea is to quantify how many secondary infections an infected individual is expected to cause in a large, fully susceptible population. Naturally, when this ratio exceeds one we expect it to spread. Conversely, a basic reproductive number less than one indicates that a pathogen is more likely to die out. This software library doesn't yet compute the ratio automatically, but does provide what's known as the "next generation matrix" which can be used to quickly calculate the quantity. <br/>

In addition to coming up with a point estimate of the ratio, it is helpful to quantify the uncertainty in the estimates obtained. Unfortunately, we can't just grab this from the MCMC output so far. Fortunately, we can just perform more samples and compute the ratio along the way as shown in the code below. 
</p>

<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-16"><div class="rcode"><div class="source"><pre class="knitr r"> <span class="hl std">getR0</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">t</span><span class="hl std">)</span>
  <span class="hl std">{</span>
    <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">eigen</span><span class="hl std">(SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">getGenerationMatrix</span><span class="hl std">(t))</span><span class="hl opt">$</span><span class="hl std">values)</span>
  <span class="hl std">}</span>

  <span class="hl std">R0_vec</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getR0)</span>

  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">500</span><span class="hl std">)</span>
  <span class="hl std">{</span>
      <span class="hl std">SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>
      <span class="hl std">R0_vec</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(R0_vec,</span><span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getR0))</span>
  <span class="hl std">}</span>

  <span class="hl std">r0.ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(R0_vec),</span> <span class="hl kwd">max</span><span class="hl std">(R0_vec))</span>
  <span class="hl std">r0.meanvec</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
  <span class="hl std">r0.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
  <span class="hl std">r0.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">figure6</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.meanvec ,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;R0&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Estimated Basic Reproductive Number\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">ylim</span> <span class="hl std">= r0.ylim,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.LB,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.UB,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span><span class="hl std">=</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">50</span><span class="hl std">,</span> <span class="hl num">0.5</span><span class="hl std">),</span> <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">1.0</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1.5</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-17"><div class="rimage center"><img src="figure/unnamed-chunk-17.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" class="plot" /></div></div>

The dip in recent days in the estimated basic reproductive ratio is definitely a hopeful sign that public health interventions and education efforts have begun to change the epidemic dynamics. Notice, on the other hand, the high variability during May. This is an interesting result, and perhaps reflects the seemingly contradicting information from Guinea (where the epidemic continued to spread) and Liberia (where the epidemic briefly disappeared).<br/>

While the basic reproductive number is a useful quantity to know, it does not directly make any predictions about future epidemic behavior. In order to do that, we need to simulate epidemics  based on the MCMC samples we have obtained and summarize their variability over time. <br/>
 

<a id="analysis-1-prediction-sect" class="anchor"></a>
<h3>Epidemic Prediction</h3>
<p>
 
 Currently the simulation required for epidemic prediction must be done "manually", or by writing a bunch of R code (given below). As the library develops, a simpler prediction interface is a high priority.  <br/> Below, we will attempt to predict the course of the epidemic through early fall. 
 We must be cautious when making predictions about a chaotic process this far into the future. We must be particularly cautious becase the basis chosen for the temporal trend in the epidemic intensity process was polynomial. While polynomial bases often provide a good fit to the data, they can behave unreasonably outside the range over which the model was fit (quadratic and cubic terms can get large very quickly). Analysis 2 will consider, in abbreviated fashion, the results of using a natural spline basis for this process instead. Spline bases extrapolate linearly, and so are less prone to extreme extrapolation errors. 
</p>

<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-18"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Declare prediction functions</span>
  <span class="hl std">predictEpidemic</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta.pred</span><span class="hl std">,</span>
                             <span class="hl kwc">X.pred</span><span class="hl std">,</span>
                             <span class="hl kwc">gamma.ei</span><span class="hl std">,</span>
                             <span class="hl kwc">gamma.ir</span><span class="hl std">,</span>
                             <span class="hl kwc">S0</span><span class="hl std">,</span>
                             <span class="hl kwc">E0</span><span class="hl std">,</span>
                             <span class="hl kwc">I0</span><span class="hl std">,</span>
                             <span class="hl kwc">R0</span><span class="hl std">,</span>
                             <span class="hl kwc">rho</span><span class="hl std">,</span>
                             <span class="hl kwc">offsets.pred</span><span class="hl std">)</span>
  <span class="hl std">{</span>
      <span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl std">(S0</span><span class="hl opt">+</span><span class="hl std">E0</span><span class="hl opt">+</span><span class="hl std">I0</span><span class="hl opt">+</span><span class="hl std">R0)</span>
      <span class="hl std">p_se_components</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">exp</span><span class="hl std">(X.pred</span> <span class="hl opt">%*%</span> <span class="hl std">beta.pred),</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0))</span>
      <span class="hl std">p_se</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl kwd">length</span><span class="hl std">(S0),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">p_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">gamma.ei</span><span class="hl opt">*</span><span class="hl std">offsets.pred)</span>
      <span class="hl std">p_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">gamma.ir</span><span class="hl opt">*</span><span class="hl std">offsets.pred)</span>
      <span class="hl std">S_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">E_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">I_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">R_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">S</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">E</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">I</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">R</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
      <span class="hl std">S[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">S0</span>
      <span class="hl std">E[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">E0</span>
      <span class="hl std">I[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">I0</span>
      <span class="hl std">R[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">R0</span>
      <span class="hl std">S_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), R0,</span> <span class="hl num">0</span><span class="hl std">)</span>
      <span class="hl std">p_se[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">offsets.pred[</span><span class="hl num">1</span><span class="hl std">]</span><span class="hl opt">*</span><span class="hl std">(I[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span>
                            <span class="hl std">rho</span><span class="hl opt">*</span><span class="hl std">(DM</span> <span class="hl opt">%*%</span> <span class="hl std">(I[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[</span><span class="hl num">1</span><span class="hl std">,]))))</span>
      <span class="hl std">E_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), S0, p_se[</span><span class="hl num">1</span><span class="hl std">,])</span>
      <span class="hl std">I_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), E0, p_ei[</span><span class="hl num">1</span><span class="hl std">])</span>
      <span class="hl std">R_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), I0, p_ir[</span><span class="hl num">1</span><span class="hl std">])</span>

      <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(S))</span>
      <span class="hl std">{</span>

        <span class="hl std">S[i,]</span> <span class="hl kwb">=</span> <span class="hl std">S[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">S_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">E_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
        <span class="hl std">E[i,]</span> <span class="hl kwb">=</span> <span class="hl std">E[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">E_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">I_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
        <span class="hl std">I[i,]</span> <span class="hl kwb">=</span> <span class="hl std">I[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">I_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">R_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
        <span class="hl std">R[i,]</span> <span class="hl kwb">=</span> <span class="hl std">R[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">R_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">S_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>

        <span class="hl std">p_se[i,]</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">offsets.pred[i]</span><span class="hl opt">*</span><span class="hl std">(I[i,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[i,]</span> <span class="hl opt">+</span>
                            <span class="hl std">rho</span><span class="hl opt">*</span><span class="hl std">(DM</span> <span class="hl opt">%*%</span> <span class="hl std">(I[i,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[i,]))))</span>
        <span class="hl std">S_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), R[i,],</span> <span class="hl num">0</span><span class="hl std">)</span>
        <span class="hl std">E_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), S[i,], p_se[i,])</span>
        <span class="hl std">I_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), E[i,], p_ei[i])</span>
        <span class="hl std">R_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), I[i,], p_ir[i])</span>
      <span class="hl std">}</span>
      <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">S</span><span class="hl std">=S,</span><span class="hl kwc">E</span><span class="hl std">=E,</span><span class="hl kwc">I</span><span class="hl std">=I,</span><span class="hl kwc">R</span><span class="hl std">=R,</span>
                  <span class="hl kwc">S_star</span><span class="hl std">=S_star,</span><span class="hl kwc">E_star</span><span class="hl std">=E_star,</span>
                  <span class="hl kwc">I_star</span><span class="hl std">=I_star,</span><span class="hl kwc">R_star</span><span class="hl std">=R_star,</span>
                  <span class="hl kwc">p_se</span><span class="hl std">=p_se,</span><span class="hl kwc">p_ei</span><span class="hl std">=p_ei,</span><span class="hl kwc">p_ir</span><span class="hl std">=p_ir))</span>
  <span class="hl std">}</span>


  <span class="hl std">predict.i</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">i</span><span class="hl std">)</span>
  <span class="hl std">{</span>
    <span class="hl std">dataRow</span> <span class="hl kwb">=</span> <span class="hl std">chain1[i,]</span>
    <span class="hl std">rho</span> <span class="hl kwb">=</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">rho</span>
    <span class="hl std">beta</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_4,</span>
             <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_5)</span>
    <span class="hl std">S0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow</span><span class="hl opt">$</span><span class="hl std">S_0_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_0_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">S_1_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_1_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">S_2_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_2_23)</span>
    <span class="hl std">E0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow</span><span class="hl opt">$</span><span class="hl std">E_0_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_0_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_0_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_1_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_1_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_1_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_2_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">E_star_2_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_2_23)</span>
    <span class="hl std">I0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow</span><span class="hl opt">$</span><span class="hl std">I_0_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_0_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_0_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_1_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_1_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_1_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_2_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">I_star_2_23</span> <span class="hl opt">-</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_2_23)</span>
    <span class="hl std">R0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow</span><span class="hl opt">$</span><span class="hl std">R_0_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_0_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_1_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_1_23,</span>
           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_2_23</span> <span class="hl opt">+</span> <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">R_star_2_23)</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">predictEpidemic</span><span class="hl std">(beta,</span>
                           <span class="hl std">X.pred,</span>
                           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">gamma_ei,</span>
                           <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">gamma_ir,</span>
                           <span class="hl std">S0,</span>
                           <span class="hl std">E0,</span>
                           <span class="hl std">I0,</span>
                           <span class="hl std">R0,</span>
                           <span class="hl std">rho,</span>
                           <span class="hl std">offset.pred</span>
                           <span class="hl std">))</span>
  <span class="hl std">}</span>
<span class="hl com"># Perform Prediction</span>
  <span class="hl std">preds</span> <span class="hl kwb">=</span> <span class="hl kwd">lapply</span><span class="hl std">((</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span> <span class="hl opt">-</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">))</span><span class="hl opt">:</span>
                   <span class="hl kwd">nrow</span><span class="hl std">(chain1), predict.i)</span>



<span class="hl std">pred.dates</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
               <span class="hl std">rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))]</span> <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl std">,</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">))</span>
<span class="hl std">pred.xlim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(rptDate),</span> <span class="hl kwd">max</span><span class="hl std">(pred.dates))</span>
<span class="hl std">lastIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span>
<span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">]</span>
<span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">]</span>

<span class="hl std">breakpoint</span> <span class="hl kwb">=</span> <span class="hl kwd">mean</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(rptDate),</span> <span class="hl kwd">min</span><span class="hl std">(pred.dates)))</span>

<span class="hl kwa">for</span> <span class="hl std">(predIdx</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(preds))</span>
<span class="hl std">{</span>
   <span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Guinea.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">])</span>
   <span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Liberia.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">])</span>
   <span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(SierraLeone.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">])</span>
<span class="hl std">}</span>

<span class="hl std">Guinea.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
<span class="hl std">Liberia.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
<span class="hl std">SierraLeone.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>

<span class="hl std">Guinea.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">Guinea.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">Liberia.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">Liberia.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">SierraLeone.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">SierraLeone.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl com">## Guinea </span>
<span class="hl std">figure7</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span> <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Guinea Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Liberia </span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Liberia Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Sierra Leone</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Sierra Leone Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-19"><div class="rimage center"><img src="figure/unnamed-chunk-19.png" title="plot of chunk unnamed-chunk-19" alt="plot of chunk unnamed-chunk-19" class="plot" /></div></div>

<p>It looks like our worries about polynomial basis functions were well founded. While these predictions are likely acceptable for several days or weeks after the currently available data, they clearly become dominated by higher order polynomial terms as time goes on. There is no data to support these large swings in epidemic behavior, so we can be fairly certain that these long term predictions are extrapolation errors. 
<br/> On the other hand,</p>
    </div>
    <div class="col-sm-1">
  </div>
 
  <a id="anchor-analysis-2-sect" class = "anchor">
  <h2>Analysis 2: Spline Basis</h2> </a>
  <div class="row">
    <div class = "col-sm-10 col-sm-offset-1">
      <p> Below is an abbreviated and concatenated modification of the code presented above. We won't be concerned with interpreting the model parameters, as the polynomial model was likely sufficient in terms of estimation.</p>
      
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="unnamed-chunk-20"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(splines)</span>
<span class="hl std">daysSinceJan.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span>
                         <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl std">,</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">))</span>
<span class="hl std">splineBasis</span> <span class="hl kwb">=</span> <span class="hl kwd">ns</span><span class="hl std">(daysSinceJan,</span> <span class="hl kwc">df</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">splineBasis.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">predict</span><span class="hl std">(splineBasis, daysSinceJan.predict)</span>

<span class="hl com"># Guinea, Liberia, Sierra Leone</span>
<span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10057975</span><span class="hl std">,</span> <span class="hl num">4128572</span><span class="hl std">,</span> <span class="hl num">6190280</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(I_star),</span><span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span>
           <span class="hl kwc">byrow</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>

<span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl std">splineBasis</span>
<span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">splineBasis.predict</span>

<span class="hl com"># These co-variates are the same for each spatial location, </span>
<span class="hl com"># so duplicate them row-wise. </span>
<span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl std">Z[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),]</span>
<span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">Z.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z.predict),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),]</span>

<span class="hl com"># For convenience, let's combine X and Z for prediction.</span>
<span class="hl std">X.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(X.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(X.predict),</span>
                             <span class="hl kwc">each</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(Z.predict)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)),], Z.predict)</span>

<span class="hl std">SEIRmodels.spline</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">()</span>
<span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl num">4</span><span class="hl std">;</span>
<span class="hl kwa">for</span> <span class="hl std">(seedVal</span> <span class="hl kwa">in</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">12345</span><span class="hl std">,</span><span class="hl num">543219</span><span class="hl std">,</span><span class="hl num">992134</span><span class="hl std">))</span>
<span class="hl std">{</span>
  <span class="hl std">proposal</span> <span class="hl kwb">=</span> <span class="hl kwd">proposeParameters</span><span class="hl std">(seedVal, i)</span>
  <span class="hl std">SEIRmodels.spline[[i</span><span class="hl opt">-</span><span class="hl num">3</span><span class="hl std">]]</span> <span class="hl kwb">=</span> <span class="hl kwd">spatialSEIRModel</span><span class="hl std">(compMatDim,</span>
                      <span class="hl std">xDim,</span>
                      <span class="hl std">zDim,</span>
                      <span class="hl std">xPrsDim,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">S0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">E0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">I0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">R0,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">S_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">E_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">I_star,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">R_star,</span>
                      <span class="hl std">offsets,</span>
                      <span class="hl std">X,</span>
                      <span class="hl std">Z,</span>
                      <span class="hl std">X_p_rs,</span>
                      <span class="hl std">DM,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">rho,</span>
                      <span class="hl std">priorAlpha_gammaEI,</span>
                      <span class="hl std">priorBeta_gammaEI,</span>
                      <span class="hl std">priorAlpha_gammaIR,</span>
                      <span class="hl std">priorBeta_gammaIR,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">beta,</span>
                      <span class="hl std">betaPriorPrecision,</span>
                      <span class="hl std">beta_p_rs,</span>
                      <span class="hl std">betaPrsPriorPrecision,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">gamma_ei,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">gamma_ir,</span>
                      <span class="hl std">N,</span>
                      <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">outFileName,</span>
                      <span class="hl std">iterationStride,</span>
                      <span class="hl std">steadyStateConstraintPrecision,</span>
                      <span class="hl std">verbose,</span>
                      <span class="hl std">debug,</span>
                      <span class="hl std">mcmcTuningParams,</span>
                      <span class="hl std">reinfectionMode,</span>
                      <span class="hl std">scaleDistanceMode)</span>

  <span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl std">i</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">;</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
## Building Model.
##    Number of Locations: 3
##    Number of Time Points: 26
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl com">#Guinea </span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">)</span> <span class="hl com">#Liberia</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">)</span> <span class="hl com">#Sierra Leone</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(SEIRmodels.spline))</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Burning in chain &quot;</span><span class="hl std">, i,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
    <span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodels.spline[[i]])</span>
    <span class="hl std">SEIRmodels.spline[[i]]</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>
    <span class="hl std">SEIRmodels.spline[[i]]</span><span class="hl opt">$</span><span class="hl kwd">printAcceptanceRates</span><span class="hl std">()</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Burning in chain 1
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.191
## I0:       0.241
## E_star:   0.296
## R_star:   0.375
## beta:     0.198, 0.198, 0.198, 0.198, 0.198, 0.198, 
## rho:      0.29
## gamma_ei:     0.169
## gamma_ir:     0.231
## Burning in chain 2
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.243
## I0:       0.204
## E_star:   0.077
## R_star:   0.257
## beta:     0.183, 0.183, 0.183, 0.183, 0.183, 0.183, 
## rho:      0.298
## gamma_ei:     0.178
## gamma_ir:     0.198
## Burning in chain 3
## Total iterations so far: 11000
## Acceptance rates: 
## S0:       0.235
## I0:       0.18
## E_star:   0.294
## R_star:   0.142
## beta:     0.227, 0.227, 0.227, 0.227, 0.227, 0.227, 
## rho:      0.297
## gamma_ei:     0.167
## gamma_ir:     0.187
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(SEIRmodels.spline))</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Running in chain &quot;</span><span class="hl std">, i,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
    <span class="hl std">tm</span> <span class="hl kwb">=</span> <span class="hl kwd">system.time</span><span class="hl std">(</span><span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodels.spline[[i]],</span>
                  <span class="hl kwc">numBatches</span><span class="hl std">=</span><span class="hl num">200</span><span class="hl std">,</span>
                  <span class="hl kwc">batchSize</span><span class="hl std">=</span><span class="hl num">10000</span><span class="hl std">,</span>
                  <span class="hl kwc">targetAcceptanceRatio</span><span class="hl std">=</span><span class="hl num">0.2</span><span class="hl std">,</span>
                  <span class="hl kwc">tolerance</span><span class="hl std">=</span><span class="hl num">0.025</span><span class="hl std">,</span>
                  <span class="hl kwc">proportionChange</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">))</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Time elapsed: &quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(tm[</span><span class="hl num">3</span><span class="hl std">]</span><span class="hl opt">/</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">3</span><span class="hl std">),</span>
              <span class="hl str">&quot; minutes\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Running in chain 1
## Time elapsed: 11.451 minutes
## Running in chain 2
## Time elapsed: 11.164 minutes
## Running in chain 3
## Time elapsed: 11.269 minutes
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">chain1</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_4.txt&quot;</span><span class="hl std">)</span>
<span class="hl std">chain2</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_5.txt&quot;</span><span class="hl std">)</span>
<span class="hl std">chain3</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_6.txt&quot;</span><span class="hl std">)</span>

<span class="hl std">figure8</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl str">&quot;Guinea Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Linear Time Component&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl str">&quot;Liberia Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Quadratic Time Component&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl str">&quot;Sierra Leone Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_3,</span>
             <span class="hl str">&quot;Cubic Time Component&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl std">figure9</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;E to I Transition Probability&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;I to R Transition Probability&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl com">## R0 stuff</span>


<span class="hl std">getR0</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">t</span><span class="hl std">)</span>
  <span class="hl std">{</span>
    <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">eigen</span><span class="hl std">(SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">getGenerationMatrix</span><span class="hl std">(t))</span><span class="hl opt">$</span><span class="hl std">values)</span>
  <span class="hl std">}</span>

  <span class="hl std">R0_vec</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getR0)</span>

  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">500</span><span class="hl std">)</span>
  <span class="hl std">{</span>
      <span class="hl std">SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(</span><span class="hl num">1000</span><span class="hl std">)</span>
      <span class="hl std">R0_vec</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(R0_vec,</span><span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">), getR0))</span>
  <span class="hl std">}</span>

  <span class="hl std">r0.ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(R0_vec),</span> <span class="hl kwd">max</span><span class="hl std">(R0_vec))</span>
  <span class="hl std">r0.meanvec</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
  <span class="hl std">r0.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
  <span class="hl std">r0.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0_vec,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">figure10</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.meanvec ,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;R0&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Estimated Basic Reproductive Number - Spline Model\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">ylim</span> <span class="hl std">= r0.ylim,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.LB,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], r0.UB,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span><span class="hl std">=</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">50</span><span class="hl std">,</span> <span class="hl num">0.5</span><span class="hl std">),</span> <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">1.0</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1.5</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
<span class="hl std">}</span>


<span class="hl com"># Guinea, Liberia, Sierra Leone</span>

<span class="hl std">getMeanAndCI</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">loc</span><span class="hl std">,</span><span class="hl kwc">tpt</span><span class="hl std">,</span><span class="hl kwc">baseStr</span><span class="hl std">=</span><span class="hl str">&quot;I_&quot;</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">chain1[[</span><span class="hl kwd">paste</span><span class="hl std">(baseStr, loc,</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">, tpt,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]]</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">vec[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(vec)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(vec)]</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">mean</span><span class="hl std">(vec),</span> <span class="hl kwd">quantile</span><span class="hl std">(vec,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">,</span> <span class="hl num">0.95</span><span class="hl std">))))</span>
<span class="hl std">}</span>

<span class="hl std">Guinea.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">Liberia.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">SierraLeone.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>

<span class="hl std">figure11</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl std">maxI</span> <span class="hl kwb">=</span> <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea.I.Est, Liberia.I.Est, SierraLeone.I.Est))</span>
  <span class="hl std">preds</span> <span class="hl kwb">=</span> <span class="hl kwd">lapply</span><span class="hl std">((</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span> <span class="hl opt">-</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">))</span><span class="hl opt">:</span>
                  <span class="hl kwd">nrow</span><span class="hl std">(chain1), predict.i)</span>


  <span class="hl std">pred.dates</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
                 <span class="hl std">rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))]</span> <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl std">,</span><span class="hl num">60</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">))</span>
  <span class="hl std">pred.xlim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(rptDate),</span> <span class="hl kwd">max</span><span class="hl std">(pred.dates))</span>
  <span class="hl std">lastIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">nrow</span><span class="hl std">(SEIRmodels.spline[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I)</span>
  <span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">]</span>
  <span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">]</span>
  <span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">]</span>

  <span class="hl std">breakpoint</span> <span class="hl kwb">=</span> <span class="hl kwd">mean</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(rptDate),</span> <span class="hl kwd">min</span><span class="hl std">(pred.dates)))</span>

  <span class="hl kwa">for</span> <span class="hl std">(predIdx</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(preds))</span>
  <span class="hl std">{</span>
     <span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Guinea.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">])</span>
     <span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Liberia.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">])</span>
     <span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(SierraLeone.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">])</span>
  <span class="hl std">}</span>

  <span class="hl std">Guinea.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
  <span class="hl std">Liberia.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
  <span class="hl std">SierraLeone.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>

  <span class="hl std">Guinea.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
  <span class="hl std">Guinea.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

  <span class="hl std">Liberia.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
  <span class="hl std">Liberia.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

  <span class="hl std">SierraLeone.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
  <span class="hl std">SierraLeone.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

  <span class="hl com">## Guinea </span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span> <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Guinea Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Liberia </span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Liberia Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Sierra Leone</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Sierra Leone Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>

<div class="chunk" id="unnamed-chunk-21"><div class="rimage center"><img src="figure/unnamed-chunk-21.png" title="plot of chunk unnamed-chunk-21" alt="plot of chunk unnamed-chunk-21" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-22"><div class="rimage center"><img src="figure/unnamed-chunk-22.png" title="plot of chunk unnamed-chunk-22" alt="plot of chunk unnamed-chunk-22" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-23"><div class="rimage center"><img src="figure/unnamed-chunk-23.png" title="plot of chunk unnamed-chunk-23" alt="plot of chunk unnamed-chunk-23" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-24"><div class="rimage center"><img src="figure/unnamed-chunk-24.png" title="plot of chunk unnamed-chunk-24" alt="plot of chunk unnamed-chunk-24" class="plot" /></div></div>



<p>These predictions do appear more reasonable. As the two sets of basis functions give similar answers in the near future, it seems likely that the epidemic will continue at a steady rate for at least the next few weeks, though we must still be careful projecting too far into the future. Still, if I had to bet, I'd bet on a steadily decreasing infection rate dropping towards zero in mid September.<br/>

That wraps up the analyses for now, though of course there are numerous other hypotheses we could explore:
<ul>
  <li>Use time varying co-variates to track the effect of various public health interventions.</li>
  <li>Explore other types of spline bases, as well as bases of different complexity (quartic etc.).</li>
  <li>Obtain better information about population flows between the three countries, or obtain more finely geocoded data to 
  examine the effect on the sub-regional level.</li>
</ul>
This document will continue to be updated as the epidemic progressesm and as the document is tracked via source control it will be easy to see how well past predictions held up and how they change in response to new information. Time permitting, some of the more nuanced analyses mentioned above will be explored as well. <br/>
</p>      
      
      </div>
    <div class="col-sm-1">
    </div>
  </div>
  
</div>
     <a id="dummy_anchor" class = "anchor"></a>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="./bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      $(".code-button").click(function(){
          $(this).next().animate({
            opacity: 1,
            left: "+=100",
            height: "toggle"
          }, 100, function() {
          });
      });
      
      $("img[class=plot]").click(function(){
        if ($(this).width() == 640)
        {
          $(this).animate({
            width: "+=300",
          }, 100, function() {
          });
        }
        else
        {
          $(this).animate({
            width: "-=300",
          }, 100, function() {
          });
        }
      });
    </script>
  </body>
</html>
